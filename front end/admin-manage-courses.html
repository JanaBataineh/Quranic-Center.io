<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ... (Ø¬Ù…ÙŠØ¹ ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù…ÙˆØ¬ÙˆØ¯Ø© Ù‡Ù†Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ) ... */
    .admin-header {
      background: linear-gradient(135deg, var(--primary-dark) 0%, #5a6b47 100%);
      color: #fff;
      padding: 2rem 0 1.5rem 0;
      text-align: center;
      border-radius: 0 0 1.5rem 1.5rem;
      margin-bottom: 2rem;
    }
    .admin-header h1 {
        margin: 0;
        font-size: 2.2rem;
    }
    .admin-controls {
      display: flex;
      justify-content: flex-start;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--secondary);
      padding-bottom: 1rem;
    }
    .courses-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        background: #fff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border-radius: 0.75rem;
        overflow: hidden;
    }
    .courses-table th, .courses-table td {
        padding: 1rem;
        text-align: right;
        border-bottom: 1px solid var(--secondary);
    }
    .courses-table th {
        background-color: var(--secondary);
        color: var(--primary-dark);
        font-weight: 600;
        font-size: 1rem;
    }
    .courses-table tr:hover {
        background-color: #fcfcfc;
    }
    .action-btn {
        margin-left: 0.5rem;
    }
    /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù†Ø´Ø· */
    .admin-controls .active-filter {
      background-color: var(--primary-dark); 
      color: white;
      border-color: var(--primary-dark);
      box-shadow: 0 0 0 2px rgba(56, 142, 60, 0.5);
    }
    
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù€ Modal/Dialog */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    .modal-overlay.hidden { display: none; }
    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title { margin: 0; color: var(--primary-dark); }
    .modal-close {
      background: none; border: none; font-size: 2rem;
      cursor: pointer; color: #888; padding: 0.5rem;
    }
    .modal-body { padding: 1.5rem; }
    .btn-block { width: 100%; margin-top: 0.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333; }
    .form-input, .form-select {
        width: 100%; padding: 0.75rem; border: 1px solid var(--muted);
        border-radius: 0.5rem; font-size: 1rem;
    }
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
    .badge-success { background-color: var(--primary); color: white; }
    .badge-warning { background-color: var(--warning); color: #333; }
    .badge-danger { background-color: var(--danger); color: white; }
    .badge-beginner { background-color: #dcfce7; color: #16a34a; }
    .badge-intermediate { background-color: #fef3c7; color: #d97706; }
    .badge-advanced { background-color: #fee2e2; color: #dc2626; }
  </style>
</head>
<body>
  
    <header class="admin-header">
        <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</h1>
        <p>Ø¹Ø±Ø¶ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø§ÙƒØ².</p>
    </header>

    <main class="container">
        
        <div class="admin-controls">
            <a href="dashbord.html" class="btn btn-sm btn-outline" style="min-width: 150px; margin-left: auto;">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
            <button class="btn btn-primary" onclick="openAddCourseModal()">Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn btn-secondary" onclick="filterCourses()">Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</button>
        </div>

        <table class="courses-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©</th>
                    <th>Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø±ÙƒØ²</th>
                    <th>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø±</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="coursesTableBody">
                </tbody>
        </table>

    </main>

    <div id="addCourseModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="courseModalTitle">Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
                <button class="modal-close" onclick="closeAddCourseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addCourseForm">
                    <input type="hidden" id="courseId" value=""> 

                    <div class="form-group">
                        <label for="courseName" class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø© *</label>
                        <input type="text" id="courseName" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseCenterId" class="form-label">Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø±ÙƒØ² (ID) *</label>
                        <input type="text" id="courseCenterId" class="form-input" placeholder="Ø§Ù„Ù…Ø¹Ø±Ù‘Ù ID Ù„Ù„Ù…Ø±ÙƒØ²" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseLevel" class="form-label">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ *</label>
                        <select id="courseLevel" class="form-select" required>
                            <option value="Ù…Ø¨ØªØ¯Ø¦">Ù…Ø¨ØªØ¯Ø¦</option>
                            <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
                            <option value="Ù…ØªÙ‚Ø¯Ù…">Ù…ØªÙ‚Ø¯Ù…</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="coursePrice" class="form-label">Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø± Ø£Ø±Ø¯Ù†ÙŠ) *</label>
                        <input type="number" id="coursePrice" class="form-input" required min="0">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block" id="courseModalSubmitBtn">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©</button>
                    <button type="button" class="btn btn-secondary btn-block" onclick="closeAddCourseModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    
                </form>
            </div>
        </div>
    </div>


<script>
    // ******************************************************
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    // ******************************************************
    
    // ğŸŒŸ ğŸ”„ ØªØºÙŠÙŠØ±: Ø§Ø³ØªØ®Ø¯Ø§Ù… API_BASE_URL Ù„ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ
    const API_BASE_URL = 'https://quranic-centerio-production.up.railway.app/api/Admin';
    let isPendingFilterActive = false;
    let currentCourseId = null; // Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªÙŠ ÙŠØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§

    // ğŸŒŸ ğŸ”„ Ø¬Ø¯ÙŠØ¯: Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆÙƒÙ†
    function getAuthToken() {
        return localStorage.getItem('authToken');
    }

    // ******************************************************
    // 2. Ø¯ÙˆØ§Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† LocalStorage)
    // ******************************************************

    /**
     * ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ø¬Ù„Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù…Ù† /api/Admin/courses
     */
    async function getCoursesFromAPI() {
        const tableBody = document.getElementById('coursesTableBody');
        tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 1.5rem;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª...</td></tr>';
        
        try {
            const response = await fetch(`${API_BASE_URL}/courses`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${getAuthToken()}`
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const courses = await response.json();
            return courses;
        } catch (error) {
            console.error("Failed to fetch courses:", error);
            tableBody.innerHTML = '<tr><td colspan="7" style="color: var(--danger); text-align: center; padding: 1.5rem;">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù€ API ÙŠØ¹Ù…Ù„.</td></tr>';
            return [];
        }
    }

    // ******************************************************
    // 3. Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Rendering)
    // ******************************************************

    function getLevelBadge(level) {
        switch (level) {
            case 'Ù…Ø¨ØªØ¯Ø¦': return 'badge-beginner';
            case 'Ù…ØªÙˆØ³Ø·': return 'badge-intermediate';
            case 'Ù…ØªÙ‚Ø¯Ù…': return 'badge-advanced';
            default: return 'badge-secondary';
        }
    }
    
    // ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ø¯Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙ (ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    function createCourseRow(course) {
        const row = document.createElement('tr');
        
        let statusBadge;
        let actionButtons = `
            <button class="btn btn-sm btn-outline action-btn" onclick="openEditCourseModal('${course.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
            <button class="btn btn-sm btn-danger action-btn" onclick="deleteCourse('${course.id}', '${course.name}')">Ø­Ø°Ù</button>
        `;

        if (course.status?.toLowerCase() === 'approved') {
            statusBadge = '<span class="badge badge-success">Ù…Ù†Ø´ÙˆØ±</span>';
        } else if (course.status?.toLowerCase() === 'pending') {
            statusBadge = '<span class="badge badge-warning">Ù…Ø¹Ù„Ù‚ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>';
            actionButtons = `
                <button class="btn btn-sm btn-primary action-btn" onclick="approveCourse('${course.id}', '${course.name}')">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                ${actionButtons}
            `;
        } else {
            statusBadge = '<span class="badge badge-secondary">ØºÙŠØ± Ù†Ø´Ø·</span>';
        }
        
        row.innerHTML = `
            <td>${course.id.substring(0, 8)}...</td> <td>${course.name}</td>
            <td>${course.centerId.substring(0, 8)}...</td> <td><span class="badge ${getLevelBadge(course.level)}">${course.level}</span></td>
            <td>${course.price} Ø¯.Ø£</td>
            <td>${statusBadge}</td>
            <td>${actionButtons}</td>
        `;
        return row;
    }

    /**
     * ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
     */
    async function renderCourses() {
        const tableBody = document.getElementById('coursesTableBody');
        
        try {
            const allCourses = await getCoursesFromAPI();
            let coursesToDisplay = allCourses;

            if (isPendingFilterActive) {
                coursesToDisplay = allCourses.filter(course => course.status?.toLowerCase() === 'pending');
            }

            tableBody.innerHTML = ''; 

            if (!coursesToDisplay || coursesToDisplay.length === 0) {
                const message = isPendingFilterActive 
                    ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹." 
                    : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
                tableBody.innerHTML = `<tr><td colspan="7" style="text-align:center; color: #888; padding: 2rem;">${message}</td></tr>`;
                return;
            }

            coursesToDisplay.forEach((course) => {
                tableBody.appendChild(createCourseRow(course));
            });

        } catch (error) {
             console.error("Critical rendering error:", error);
        }
    }

    // ******************************************************
    // 4. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… (CRUD) Ø§Ù„Ù…ØªØµÙ„Ø© Ø¨Ø§Ù„Ù€ API
    // ******************************************************

    /**
     * ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ±Ø© Ø¹Ø¨Ø± API
     * PUT: /api/Admin/courses/approve/{id}
     */
    async function approveCourse(courseId, courseName) {
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆØ±Ø© "${courseName}" ÙˆÙ†Ø´Ø±Ù‡Ø§ØŸ`)) {
            try {
                const response = await fetch(`${API_BASE_URL}/courses/approve/${courseId}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
    
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯.');
                }
    
                const data = await response.json();
                alert(`âœ… ${data.message || 'ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­.'}`);
                await renderCourses(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                
            } catch (error) {
                console.error('Approval Error:', error);
                alert(`âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯: ${error.message}`);
            }
        }
    }

    /**
     * ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±Ø© Ø¹Ø¨Ø± API
     * DELETE: /api/Admin/courses/{id}
     */
    async function deleteCourse(courseId, courseName) {
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ±Ø© "${courseName}" Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…ØŸ`)) {
            try {
                const response = await fetch(`${API_BASE_URL}/courses/${courseId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.');
                }

                const data = await response.json();
                alert(`âœ… ${data.message || 'ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­.'}`);
                await renderCourses(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                
            } catch (error) {
                console.error('Deletion Error:', error);
                alert(`âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ${error.message}`);
            }
        }
    }

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØµÙÙŠØ© (Ù„Ù… ØªØªØºÙŠØ±)
    function filterCourses() {
        const pendingButton = document.querySelector('.admin-controls button[onclick*="filterCourses"]');
        isPendingFilterActive = !isPendingFilterActive;

        if (isPendingFilterActive) {
            pendingButton.classList.add('active-filter');
            pendingButton.textContent = 'Ø¥Ù„ØºØ§Ø¡ ØªØµÙÙŠØ© Ø§Ù„Ø¯ÙˆØ±Ø§Øª';
        } else {
            pendingButton.classList.remove('active-filter');
            pendingButton.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©';
        }
        renderCourses();
    }

    // ******************************************************
    // 5. Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ (Modal Functions)
    // ******************************************************

    function openAddCourseModal() {
        currentCourseId = null;
        document.getElementById('courseModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¯ÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©';
        document.getElementById('courseModalSubmitBtn').textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©';
        document.getElementById('courseId').value = ''; 
        document.getElementById('addCourseForm').reset();
        document.getElementById('addCourseModal').classList.remove('hidden');
    }

    /**
     * ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ù…Ù† Ø§Ù„Ù€ API Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
     * GET: /api/Admin/courses/{id}
     */
    async function openEditCourseModal(courseId) {
        currentCourseId = courseId;
        
        try {
            const response = await fetch(`${API_BASE_URL}/courses/${courseId}`, {
                 headers: { 'Authorization': `Bearer ${getAuthToken()}` }
            });
            if (!response.ok) throw new Error('ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø©.');
            
            const course = await response.json();

            document.getElementById('courseModalTitle').textContent = `ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª: ${course.name}`;
            document.getElementById('courseModalSubmitBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
            document.getElementById('courseId').value = course.id; 

            document.getElementById('courseName').value = course.name;
            document.getElementById('courseCenterId').value = course.centerId;
            document.getElementById('courseLevel').value = course.level;
            document.getElementById('coursePrice').value = course.price;

            document.getElementById('addCourseModal').classList.remove('hidden');

        } catch (error) {
            alert(`âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø©: ${error.message}`);
        }
    }

    function closeAddCourseModal() {
        document.getElementById('addCourseModal').classList.add('hidden');
        document.getElementById('addCourseForm').reset();
        currentCourseId = null;
    }

    /**
     * ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ (Ù„Ù„Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„) Ø¹Ø¨Ø± API
     * POST: /api/Admin/courses (Ù„Ù„Ø¥Ø¶Ø§ÙØ©)
     * PUT: /api/Admin/courses/{id} (Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)
     */
    document.getElementById('addCourseForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const courseId = currentCourseId;
        const isEditing = !!courseId;
        
        const formData = {
            id: courseId,
            name: document.getElementById('courseName').value,
            centerId: document.getElementById('courseCenterId').value, // ğŸŒŸ ØªØºÙŠÙŠØ±: Ø£ØµØ¨Ø­ ID
            level: document.getElementById('courseLevel').value,
            price: parseFloat(document.getElementById('coursePrice').value),
            status: isEditing ? undefined : 'pending' // ğŸŒŸ Ø¥Ø±Ø³Ø§Ù„ "pending" ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
        };

        try {
            const url = isEditing ? `${API_BASE_URL}/courses/${courseId}` : `${API_BASE_URL}/courses`;
            const method = isEditing ? 'PUT' : 'POST';

            const response = await fetch(url, {
                method: method,
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${getAuthToken()}`
                },
                body: JSON.stringify(formData)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || `ÙØ´Ù„ ÙÙŠ ${isEditing ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Ø¥Ø¶Ø§ÙØ©'} Ø§Ù„Ø¯ÙˆØ±Ø©.`);
            }
            
            const data = await response.json();
            alert(`âœ… ${data.message || 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!'}`); 

        } catch (error) {
            console.error(`${isEditing ? 'Update' : 'Create'} Error:`, error);
            alert(`âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
        }

        closeAddCourseModal();
        await renderCourses(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ù„ÙÙŠØ©
    document.getElementById('addCourseModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeAddCourseModal();
        }
    });

    // ğŸŒŸ ğŸ”„ ØªØ­Ø¯ÙŠØ«: Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', renderCourses);
</script>
</body>
</html>