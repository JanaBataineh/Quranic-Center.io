<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙƒØ² - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* (... Ø¬Ù…ÙŠØ¹ ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù…ÙˆØ¬ÙˆØ¯Ø© Ù‡Ù†Ø§ ...) */
    .admin-header {
      background: linear-gradient(135deg, var(--primary-dark) 0%, #5a6b47 100%);
      color: #fff;
      padding: 2rem 0 1.5rem 0;
      text-align: center;
      border-radius: 0 0 1.5rem 1.5rem;
      margin-bottom: 2rem;
    }
    .admin-header h1 {
        margin: 0;
        font-size: 2.2rem;
    }
    .admin-controls {
      display: flex;
      justify-content: flex-start;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--secondary);
      padding-bottom: 1rem;
    }
    .centers-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        background: #fff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border-radius: 0.75rem;
        overflow: hidden;
    }
    .centers-table th, .centers-table td {
        padding: 1rem;
        text-align: right;
        border-bottom: 1px solid var(--secondary);
    }
    .centers-table th {
        background-color: var(--secondary);
        color: var(--primary-dark);
        font-weight: 600;
        font-size: 1rem;
    }
    .centers-table tr:hover {
        background-color: #fcfcfc;
    }
    .action-btn {
        margin-left: 0.5rem;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    .modal-overlay.hidden {
      display: none;
    }
    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title {
        margin: 0;
        color: var(--primary-dark);
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      color: #888;
      padding: 0.5rem;
    }
    .modal-body {
        padding: 1.5rem;
    }
    .btn-block {
        width: 100%;
        margin-top: 0.5rem;
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333;
    }
    .form-input, .form-select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--muted);
        border-radius: 0.5rem;
        font-size: 1rem;
    }
    .badge {
        display: inline-block;
        padding: 0.3em 0.7em;
        border-radius: 0.5rem;
        font-size: 0.9em;
        font-weight: 600;
        color: white;
        text-align: center;
    }
    .badge-success { background-color: var(--primary); }
    .badge-warning { background-color: var(--warning); }
    .badge-danger { background-color: var(--danger); }
  </style>
</head>
<body>
  
    <header class="admin-header">
        <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©</h1>
        <p>Ø¹Ø±Ø¶ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø© ÙˆØ§Ù„Ù…Ø¹Ù„Ù‚Ø©.</p>
    </header>

    <main class="container">
        
       <div class="admin-controls">
            <a href="dashbord.html" class="btn btn-sm btn-outline" style="min-width: 150px; margin-left: auto;">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </a>
            
            <button class="btn btn-primary" onclick="openAddCenterModal()">Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¬Ø¯ÙŠØ¯</button>
            <button class="btn btn-secondary" onclick="filterCenters()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</button>
       </div>

        <table class="centers-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²</th>
                    <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                    <th>Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø±</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="centersTableBody">
                </tbody>
        </table>

    </main>

    <div id="addCenterModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="centerModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ù‚Ø±Ø¢Ù†ÙŠ Ø¬Ø¯ÙŠØ¯</h2>
                <button class="modal-close" onclick="closeAddCenterModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addCenterForm">
                    
                    <input type="hidden" id="centerId" value=""> 

                    <div class="form-group">
                        <label for="centerName" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ² *</label>
                        <input type="text" id="centerName" class="form-input" placeholder="Ù…Ø«Ù„: Ù…Ø±ÙƒØ² Ø§Ù„ØµØ¯ÙŠÙ‚ Ù„ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù†" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="centerCity" class="form-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *</label>
                        <select id="centerCity" class="form-select" required>
                            <option value="">Ø§Ø®ØªØ± Ù…Ø¯ÙŠÙ†Ø©...</option>
                            <option value="Ø§Ø±Ø¨Ø¯">Ø§Ø±Ø¨Ø¯</option>
                            <option value="Ø§Ù„Ø¨Ù„Ù‚Ø§Ø¡">Ø§Ù„Ø¨Ù„Ù‚Ø§Ø¡</option>
                            <option value="Ø¹Ù…Ø§Ù†">Ø¹Ù…Ø§Ù†</option>
                            <option value="Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡">Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="centerAddress" class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *</label>
                        <input type="text" id="centerAddress" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„ÙƒØ¨ÙŠØ±" required>
                    </div>

                  <div class="form-group">
    <label for="centerPhone" class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
    <input type="tel" id="centerPhone" class="form-input" placeholder="+9627xxxxxxxx" required>
</div>

<div class="form-group">
    <label for="centerEmail" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
    <input type="email" id="centerEmail" class="form-input" placeholder="info@example.com" required>
</div>



                    
                    <div class="form-group">
                        <label for="centerImage" class="form-label">Ø´Ø¹Ø§Ø±/ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙƒØ²</label>
                        <input type="file" id="centerImage" class="form-input-file" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label for="centerEstablished" class="form-label">Ø³Ù†Ø© Ø§Ù„ØªØ£Ø³ÙŠØ³</label>
                        <input type="number" id="centerEstablished" class="form-input" placeholder="Ù…Ø«Ø§Ù„: 1999" min="1900" max="2025">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block" id="centerModalSubmitBtn">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©</button>
                    <button type="button" class="btn btn-secondary btn-block" onclick="closeAddCenterModal()">Ø¥Ù„ØºØ§Ø¡</button>
                    
                </form>
            </div>
        </div>
    </div>


<script>
    // ----------------------------------------------------
    // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª API ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    // ----------------------------------------------------
    
    // ğŸŒŸ 1. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ø­Ù„ÙŠ
    const API_BASE_URL = 'https://quranic-centerio-production.up.railway.app/api/Admin';
    
    // ğŸŒŸ 2. ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù… (Global Scope)
    let isPendingFilterActive = false; 
    let currentCenterId = null; 

    // ----------------------------------------------------
    // 2. Ø¯ÙˆØ§Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† API
    // ----------------------------------------------------
    function getAuthToken() {
        return localStorage.getItem('authToken');
    }

    async function getCentersFromAPI() {
        const tableBody = document.getElementById('centersTableBody');
        tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 1.5rem;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ²...</td></tr>';
        
        try {
            const response = await fetch(`${API_BASE_URL}/centers`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${getAuthToken()}`
                }
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const centers = await response.json();
            return centers;
        } catch (error) {
            console.error("Failed to fetch centers:", error);
            tableBody.innerHTML = '<tr><td colspan="6" style="color: var(--danger); text-align: center; padding: 1.5rem;">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù€ API ÙŠØ¹Ù…Ù„.</td></tr>';
            return [];
        }
    }


    // ----------------------------------------------------
    // 3. Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Rendering)
    // ----------------------------------------------------
    
    function getStatusBadge(status) {
        let className = '';
        let text = '';
        switch(status?.toLowerCase()) {
            case 'approved': className = 'badge-success'; text = 'Ù…Ø¹ØªÙ…Ø¯'; break;
            case 'pending': className = 'badge-warning'; text = 'Ù…Ø¹Ù„Ù‚'; break;
            case 'rejected': className = 'badge-danger'; text = 'Ù…Ø±ÙÙˆØ¶'; break;
            default: className = 'badge-secondary'; text = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }
        return `<span class="badge ${className}">${text}</span>`;
    }

    function createCenterRow(center) {
        const row = document.createElement('tr');
        const formattedDate = center.createdAt ? new Date(center.createdAt).toLocaleDateString('ar-EG', { year: 'numeric', month: 'short', day: 'numeric' }) : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

        row.innerHTML = `
            <td>${center.id.substring(0, 8)}...</td>
            <td>${center.name}</td>
            <td>${center.city}</td>
            <td>${getStatusBadge(center.status)}</td>
            <td>${formattedDate}</td>
            <td>
                <button class="btn btn-sm btn-outline action-btn" onclick="editCenter('${center.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
                ${center.status?.toLowerCase() === 'pending' ? 
                    `<button class="btn btn-sm btn-success action-btn" onclick="approveCenter('${center.id}', '${center.name}')">Ø§Ø¹ØªÙ…Ø§Ø¯</button>` : ''
                }
                <button class="btn btn-sm btn-danger action-btn" onclick="deleteCenter('${center.id}', '${center.name}')">Ø­Ø°Ù</button>
            </td>
        `;
        return row;
    }
    
    async function renderCenters() {
        const tableBody = document.getElementById('centersTableBody');
        
        try {
            const allCenters = await getCentersFromAPI(); 
            let centersToDisplay = allCenters;

            // (Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± ÙŠØ¹ØªÙ…Ø¯ Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ù…Ø¹Ø±Ù Ø£Ø¹Ù„Ø§Ù‡)
            if (isPendingFilterActive) {
                centersToDisplay = allCenters.filter(center => center.status.toLowerCase() === 'pending');
            }

            tableBody.innerHTML = ''; 
        
            if (!centersToDisplay || centersToDisplay.length === 0) {
                const message = isPendingFilterActive 
                    ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§ÙƒØ² Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø­Ø§Ù„ÙŠØ§Ù‹." 
                    : "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§ÙƒØ² Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
                tableBody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 1.5rem; color: var(--muted);">${message}</td></tr>`;
                return;
            }

            centersToDisplay.forEach(center => {
                tableBody.appendChild(createCenterRow(center));
            });

        } catch (error) {
             console.error("Critical rendering error during fetch:", error);
        }
    }


    // ----------------------------------------------------
    // 4. Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª (Ù…Ø¹Ø±ÙØ© ÙÙŠ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù…)
    // ----------------------------------------------------

    function filterCenters() {
        const pendingButton = document.querySelector('.admin-controls button[onclick="filterCenters()"]');
        isPendingFilterActive = !isPendingFilterActive; 

        if (isPendingFilterActive) {
            pendingButton.textContent = 'Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ²';
            pendingButton.classList.add('btn-primary'); 
            pendingButton.classList.remove('btn-secondary');
        } else {
            pendingButton.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©';
            pendingButton.classList.remove('btn-primary');
            pendingButton.classList.add('btn-secondary');
        }
        
        renderCenters(); 
    }

    function openAddCenterModal() {
        currentCenterId = null;
        document.getElementById('centerModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¬Ø¯ÙŠØ¯';
        document.getElementById('centerModalSubmitBtn').textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©';
        document.getElementById('addCenterForm').reset();
        document.getElementById('addCenterModal').classList.remove('hidden');
    }

    function closeAddCenterModal() {
        document.getElementById('addCenterModal').classList.add('hidden');
        currentCenterId = null;
    }

  async function editCenter(centerId) {
    prompt("Ø§Ù†Ø³Ø® Ø§Ù„Ù€ ID Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø±ÙƒØ²:", centerId);

    currentCenterId = centerId; 

    try {
            const response = await fetch(`${API_BASE_URL}/centers/${centerId}`, {
                headers: { 'Authorization': `Bearer ${getAuthToken()}` }
            });
            
            if (!response.ok) {
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ÙØ´Ù„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ² Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.');
                } else {
                    throw new Error('Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ù„ÙŠØ³Øª JSON. ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
                }
            }

            const centerData = await response.json(); 
            
            document.getElementById('centerModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²';
            document.getElementById('centerModalSubmitBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª'; 
            
            document.getElementById('centerName').value = centerData.name;
            document.getElementById('centerCity').value = centerData.city;
            document.getElementById('centerAddress').value = centerData.address;
            document.getElementById('centerPhone').value = centerData.phone;
            document.getElementById('centerEmail').value = centerData.email; 
            document.getElementById('centerEstablished').value = centerData.established;

            document.getElementById('addCenterModal').classList.remove('hidden');

        } catch (error) {
            console.error('Fetch Center Error:', error);
            alert(`âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²: ${error.message}`);
        }
    }

    async function approveCenter(centerId, centerName) {
        if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø±ÙƒØ² "${centerName}"ØŸ Ø³ÙŠØµØ¨Ø­ Ù…ØªØ§Ø­Ù‹Ø§ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.`)) {
            try {
                const response = await fetch(`${API_BASE_URL}/centers/approve/${centerId}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });
    
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯.');
                }
    
                const data = await response.json();
                alert(`âœ… ${data.message}`);
                
            } catch (error) {
                console.error('Approval Error:', error);
                alert(`âŒ ÙØ´Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯: ${error.message}`);
            }
            
            await renderCenters(); 
        }
    }

    async function deleteCenter(centerId, centerName) {
        if (confirm(`ØªØ­Ø°ÙŠØ±! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ² "${centerName}" Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ`)) {
            try {
                const response = await fetch(`${API_BASE_URL}/centers/${centerId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${getAuthToken()}` }
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù.');
                }

                const data = await response.json();
                alert(`âœ… ${data.message}`);
                
            } catch (error) {
                console.error('Deletion Error:', error);
                alert(`âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: ${error.message}`);
            }

            await renderCenters(); 
        }
    }


    // ----------------------------------------------------
    // 5. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    // ----------------------------------------------------

    document.addEventListener('DOMContentLoaded', function() {
        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        renderCenters();

        // 2. Ø±Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        document.getElementById('addCenterForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const centerName = document.getElementById('centerName').value;
            const centerCity = document.getElementById('centerCity').value;

            if (centerName.trim() === "" || centerCity.trim() === "") {
                alert("âŒ Ø®Ø·Ø£: ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø­Ù‚Ù„ÙŠ (Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²) Ùˆ (Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©) Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
                return; 
            }

            const centerId = currentCenterId;
            const isEditing = !!centerId; 
            
            const formData = {
               name: centerName,
               city: centerCity,
               address: document.getElementById('centerAddress').value,
               phone: document.getElementById('centerPhone').value,
               email: document.getElementById('centerEmail').value, 
               established: parseInt(document.getElementById('centerEstablished').value) || 0,
               id: centerId // (Ø³ÙŠÙƒÙˆÙ† null Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©)
            };

            try {
                const url = isEditing ? `${API_BASE_URL}/centers/${centerId}` : `${API_BASE_URL}/centers`;
                const method = isEditing ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}`
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `ÙØ´Ù„ ÙÙŠ ${isEditing ? 'ØªØ¹Ø¯ÙŠÙ„' : 'Ø¥Ø¶Ø§ÙØ©'} Ø§Ù„Ù…Ø±ÙƒØ².`);
                }
                
                const data = await response.json();
                alert(`âœ… ${data.message || 'ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!'}`); 

            } catch (error) {
                console.error(`${isEditing ? 'Update' : 'Create'} Error:`, error);
                alert(`âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            }

            closeAddCenterModal();
            await renderCenters(); 
        });

        // 3. Ø±Ø¨Ø· Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
        const modalOverlay = document.getElementById('addCenterModal');
        if (modalOverlay) {
             modalOverlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddCenterModal();
                }
            });
        }
    });
</script>
</body>
</html>