<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة الدورات - لوحة التحكم</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* تنسيقات خاصة بالصفحة الإدارية */
    .admin-header {
      background: linear-gradient(135deg, var(--primary-dark) 0%, #5a6b47 100%);
      color: #fff;
      padding: 2rem 0 1.5rem 0;
      text-align: center;
      border-radius: 0 0 1.5rem 1.5rem;
      margin-bottom: 2rem;
    }
    .admin-header h1 {
        margin: 0;
        font-size: 2.2rem;
    }
    .admin-controls {
      display: flex;
      justify-content: flex-start;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--secondary);
      padding-bottom: 1rem;
    }
    .courses-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        background: #fff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border-radius: 0.75rem;
        overflow: hidden;
    }
    .courses-table th, .courses-table td {
        padding: 1rem;
        text-align: right;
        border-bottom: 1px solid var(--secondary);
    }
    .courses-table th {
        background-color: var(--secondary);
        color: var(--primary-dark);
        font-weight: 600;
        font-size: 1rem;
    }
    .courses-table tr:hover {
        background-color: #fcfcfc;
    }
    .action-btn {
        margin-left: 0.5rem;
    }
    /* تنسيق زر التصفية النشط */
    .admin-controls .active-filter {
      background-color: var(--primary-dark); 
      color: white;
      border-color: var(--primary-dark);
      box-shadow: 0 0 0 2px rgba(56, 142, 60, 0.5);
    }
    
    /* تنسيقات الـ Modal/Dialog */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    .modal-overlay.hidden { display: none; }
    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title { margin: 0; color: var(--primary-dark); }
    .modal-close {
      background: none; border: none; font-size: 2rem;
      cursor: pointer; color: #888; padding: 0.5rem;
    }
    .modal-body { padding: 1.5rem; }
    .btn-block { width: 100%; margin-top: 0.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333; }
    .form-input, .form-select {
        width: 100%; padding: 0.75rem; border: 1px solid var(--muted);
        border-radius: 0.5rem; font-size: 1rem;
    }
    /* تنسيقات شارات الحالة */
    .badge-success { background-color: var(--primary); color: white; }
    .badge-warning { background-color: var(--warning); color: #333; }
    .badge-danger { background-color: var(--danger); color: white; }
    .badge-beginner { background-color: #dcfce7; color: #16a34a; }
    .badge-intermediate { background-color: #fef3c7; color: #d97706; }
    .badge-advanced { background-color: #fee2e2; color: #dc2626; }
  </style>
</head>
<body>
  
    <header class="admin-header">
        <h1>إدارة الدورات التدريبية</h1>
        <p>عرض، تعديل، وإدارة جميع الدورات المتاحة في المراكز.</p>
    </header>

    <main class="container">
        
        <div class="admin-controls">
            <a href="dashbord.html" class="btn btn-sm btn-outline" style="min-width: 150px; margin-left: auto;">
                ← العودة للوحة التحكم
            </a>
            <button class="btn btn-primary" onclick="openAddCourseModal()">إضافة دورة جديدة</button>
            <button class="btn btn-secondary" onclick="filterCourses()">عرض الدورات المعلقة</button>
        </div>

        <table class="courses-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>اسم الدورة</th>
                    <th>المركز</th>
                    <th>المستوى</th>
                    <th>السعر</th>
                    <th>حالة النشر</th>
                    <th>الإجراءات</th>
                </tr>
            </thead>
            <tbody id="coursesTableBody">
                </tbody>
        </table>

    </main>

    <div id="addCourseModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="courseModalTitle">إضافة دورة تدريبية جديدة</h2>
                <button class="modal-close" onclick="closeAddCourseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addCourseForm">
                    
                    <input type="hidden" id="courseId" value=""> 

                    <div class="form-group">
                        <label for="courseName" class="form-label">اسم الدورة *</label>
                        <input type="text" id="courseName" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseCenter" class="form-label">المركز التابع *</label>
                        <input type="text" id="courseCenter" class="form-input" placeholder="اسم المركز" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="courseLevel" class="form-label">المستوى *</label>
                        <select id="courseLevel" class="form-select" required>
                            <option value="مبتدئ">مبتدئ</option>
                            <option value="متوسط">متوسط</option>
                            <option value="متقدم">متقدم</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="coursePrice" class="form-label">السعر (دينار أردني) *</label>
                        <input type="number" id="coursePrice" class="form-input" required min="0">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block" id="courseModalSubmitBtn">إرسال للموافقة</button>
                    <button type="button" class="btn btn-secondary btn-block" onclick="closeAddCourseModal()">إلغاء</button>
                    
                </form>
            </div>
        </div>
    </div>


<script>
    // ******************************************************
    // دوال الحفظ والتحميل من LocalStorage
    // ******************************************************
    function getCoursesData() {
        const storedData = localStorage.getItem('mockCourses');
        if (storedData) {
            return JSON.parse(storedData);
        } else {
            // بيانات تجريبية أولية
            return [
                { id: '101', name: 'دورة تمهيدية في احكام التجويد', center: 'مركز الصديق', level: 'مبتدئ', price: 20, status: 'approved' },
                { id: '102', name: 'إجازة في القراءات العشر', center: 'مركز ابن تيمية', level: 'متقدم', price: 45, status: 'approved' },
                { id: '103', name: 'حفظ جزء عم', center: 'مركز علي بن ابي طالب', level: 'مبتدئ', price: 15, status: 'pending' },
                { id: '104', name: 'دورة الخط العثماني', center: 'مركز ابي بن كعب', level: 'متوسط', price: 30, status: 'approved' }
            ];
        }
    }

    function saveCoursesData(coursesArray) {
        localStorage.setItem('mockCourses', JSON.stringify(coursesArray));
    }

    let mockCourses = getCoursesData(); 
    let isPendingFilterActive = false;
    
    // ******************************************************
    // الدوال الأساسية للتحكم بالجدول (CRUD Operations)
    // ******************************************************

    function getLevelBadge(level) {
        switch (level) {
            case 'مبتدئ': return 'badge-beginner';
            case 'متوسط': return 'badge-intermediate';
            case 'متقدم': return 'badge-advanced';
            default: return 'badge-secondary';
        }
    }

    function renderCourses() {
        mockCourses = getCoursesData(); 
        const tableBody = document.getElementById('coursesTableBody');
        tableBody.innerHTML = ''; 

        let coursesToDisplay = mockCourses;

        if (isPendingFilterActive) {
            coursesToDisplay = mockCourses.filter(course => course.status === 'pending');
        }

        if (coursesToDisplay.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="7" style="text-align:center; color: #888; padding: 2rem;">لا توجد دورات مطابقة للمعايير المحددة حالياً.</td></tr>';
            return;
        }

        coursesToDisplay.forEach((course) => {
            let statusBadge;
            let actionButtons = `
                <button class="btn btn-sm btn-outline action-btn" onclick="openEditCourseModal('${course.id}')">تعديل</button>
                <button class="btn btn-sm btn-danger action-btn" onclick="deleteCourse('${course.id}')">حذف</button>
            `;

            if (course.status === 'approved') {
                statusBadge = '<span class="badge badge-success">منشور</span>';
            } else if (course.status === 'pending') {
                statusBadge = '<span class="badge badge-warning">معلق للموافقة</span>';
                actionButtons = `
                    <button class="btn btn-sm btn-primary action-btn" onclick="approveCourse('${course.id}')">موافقة</button>
                    ${actionButtons}
                `;
            } else {
                statusBadge = '<span class="badge badge-secondary">غير نشط</span>';
            }
            
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td>${course.id}</td>
                <td>${course.name}</td>
                <td>${course.center}</td>
                <td><span class="badge ${getLevelBadge(course.level)}">${course.level}</span></td>
                <td>${course.price} د.أ</td>
                <td>${statusBadge}</td>
                <td>${actionButtons}</td>
            `;
        });
    }

    function approveCourse(courseId) {
        if (confirm(`هل أنت متأكد من الموافقة على الدورة ونشرها؟`)) {
            const courseIndex = mockCourses.findIndex(c => c.id === courseId);
            if (courseIndex !== -1) {
                mockCourses[courseIndex].status = 'approved';
                saveCoursesData(mockCourses); 
                renderCourses(); 
                alert(`تمت الموافقة على الدورة بنجاح.`);
            }
        }
    }

    function deleteCourse(courseId) {
        if (confirm(`هل أنت متأكد من حذف هذه الدورة بشكل دائم؟`)) {
            mockCourses = mockCourses.filter(c => c.id !== courseId);
            saveCoursesData(mockCourses); 
            renderCourses(); 
            alert(`تم حذف الدورة بنجاح.`);
        }
    }

    function filterCourses() {
        const pendingButton = document.querySelector('.admin-controls button[onclick*="filterCourses"]');
        
        isPendingFilterActive = !isPendingFilterActive;

        if (isPendingFilterActive) {
            pendingButton.classList.add('active-filter');
            pendingButton.textContent = 'إلغاء تصفية الدورات';
        } else {
            pendingButton.classList.remove('active-filter');
            pendingButton.textContent = 'عرض الدورات المعلقة';
        }
        
        renderCourses();
    }

    // ******************************************************
    // الدوال الخاصة بالنموذج المنبثق (Modal Functions)
    // ******************************************************

    function openAddCourseModal() {
        document.getElementById('courseModalTitle').textContent = 'إضافة دورة تدريبية جديدة';
        document.getElementById('courseModalSubmitBtn').textContent = 'إرسال للموافقة';
        document.getElementById('courseId').value = ''; 
        document.getElementById('addCourseForm').reset();
        document.getElementById('addCourseModal').classList.remove('hidden');
    }

    function openEditCourseModal(courseId) {
        const course = mockCourses.find(c => c.id === courseId);

        if (!course) {
            alert('لم يتم العثور على بيانات الدورة!');
            return;
        }

        document.getElementById('courseModalTitle').textContent = `تعديل بيانات: ${course.name}`;
        document.getElementById('courseModalSubmitBtn').textContent = 'حفظ التعديلات';
        document.getElementById('courseId').value = courseId; 

        document.getElementById('courseName').value = course.name;
        document.getElementById('courseCenter').value = course.center;
        document.getElementById('courseLevel').value = course.level;
        document.getElementById('coursePrice').value = course.price;

        document.getElementById('addCourseModal').classList.remove('hidden');
    }

    function closeAddCourseModal() {
        document.getElementById('addCourseModal').classList.add('hidden');
        document.getElementById('addCourseForm').reset();
    }

    // معالج إرسال النموذج (للإضافة والتعديل)
    document.getElementById('addCourseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const courseId = document.getElementById('courseId').value;
        const courseName = document.getElementById('courseName').value;
        
        const formData = {
            name: document.getElementById('courseName').value,
            center: document.getElementById('courseCenter').value,
            level: document.getElementById('courseLevel').value,
            price: parseFloat(document.getElementById('coursePrice').value),
        };

        if (courseId) {
            // عملية تعديل
            const courseIndex = mockCourses.findIndex(c => c.id === courseId);
            if (courseIndex !== -1) {
                mockCourses[courseIndex] = { ...mockCourses[courseIndex], ...formData };
            }
            alert(`تم حفظ تعديلات الدورة: ${courseName}.`);
        } else {
            // عملية إضافة
            const newId = (mockCourses.length > 0 ? Math.max(...mockCourses.map(c => parseInt(c.id))) + 1 : 1).toString();
            const newCourse = {
                id: newId, 
                ...formData,
                status: 'pending' 
            };
            mockCourses.push(newCourse);
            alert(`تم إرسال بيانات الدورة الجديدة: ${courseName} للموافقة.`);
        }
        
        saveCoursesData(mockCourses); 
        closeAddCourseModal();
        renderCourses(); 
    });
    
    document.getElementById('addCourseModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeAddCourseModal();
        }
    });

    document.addEventListener('DOMContentLoaded', renderCourses);
</script>
</body>
</html>