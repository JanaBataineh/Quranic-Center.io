<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة المراكز - لوحة التحكم</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* تنسيقات خاصة بالصفحة الإدارية */
    .admin-header {
      background: linear-gradient(135deg, var(--primary-dark) 0%, #5a6b47 100%);
      color: #fff;
      padding: 2rem 0 1.5rem 0;
      text-align: center;
      border-radius: 0 0 1.5rem 1.5rem;
      margin-bottom: 2rem;
    }
    .admin-header h1 {
        margin: 0;
        font-size: 2.2rem;
    }
    .admin-controls {
      display: flex;
      justify-content: flex-start;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--secondary);
      padding-bottom: 1rem;
    }
    .centers-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
        background: #fff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border-radius: 0.75rem;
        overflow: hidden;
    }
    .centers-table th, .centers-table td {
        padding: 1rem;
        text-align: right;
        border-bottom: 1px solid var(--secondary);
    }
    .centers-table th {
        background-color: var(--secondary);
        color: var(--primary-dark);
        font-weight: 600;
        font-size: 1rem;
    }
    .centers-table tr:hover {
        background-color: #fcfcfc;
    }
    .action-btn {
        margin-left: 0.5rem;
    }

    /* تنسيق زر التصفية النشط */
    .admin-controls .active-filter {
      background-color: var(--primary-dark); 
      color: white;
      border-color: var(--primary-dark);
      box-shadow: 0 0 0 2px rgba(56, 142, 60, 0.5);
    }
    
    /* تنسيقات الـ Modal/Dialog */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }

    .modal-overlay.hidden {
      display: none;
    }

    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-header {
      padding: 1.5rem;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
        margin: 0;
        color: var(--primary-dark);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 2rem;
      cursor: pointer;
      color: #888;
      padding: 0.5rem;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .btn-block {
        width: 100%;
        margin-top: 0.5rem;
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333;
    }
    .form-input, .form-select {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--muted);
        border-radius: 0.5rem;
        font-size: 1rem;
    }
    /* تنسيقات شارات الحالة */
    .badge {
        display: inline-block;
        padding: 0.3em 0.7em;
        border-radius: 0.5rem;
        font-size: 0.9em;
        font-weight: 600;
        color: white;
        text-align: center;
    }
    .badge-success { background-color: var(--primary); }
    .badge-warning { background-color: var(--warning); }
    .badge-danger { background-color: var(--danger); }
  </style>
</head>
<body>
  
    <header class="admin-header">
        <h1>إدارة المراكز القرآنية</h1>
        <p>عرض، تعديل، وإدارة المراكز المعتمدة والمعلقة.</p>
    </header>

    <main class="container">
        
       <div class="admin-controls">
    <a href="dashbord.html" class="btn btn-sm btn-outline" style="min-width: 150px; margin-left: auto;">
        ← العودة للوحة التحكم
    </a>
    
    <button class="btn btn-primary" onclick="openAddCenterModal()">إضافة مركز جديد</button>
    <button class="btn btn-secondary" onclick="filterCenters()">عرض المراكز المعلقة</button>
</div>

        <table class="centers-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>اسم المركز</th>
                    <th>المدينة</th>
                    <th>حالة النشر</th>
                    <th>تاريخ الإضافة</th>
                    <th>الإجراءات</th>
                </tr>
            </thead>
            <tbody id="centersTableBody">
                </tbody>
        </table>

    </main>

    <div id="addCenterModal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="centerModalTitle">إضافة مركز قرآني جديد</h2>
                <button class="modal-close" onclick="closeAddCenterModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addCenterForm">
                    
                    <input type="hidden" id="centerId" value=""> 

                    <div class="form-group">
                        <label for="centerName" class="form-label">اسم المركز *</label>
                        <input type="text" id="centerName" class="form-input" placeholder="مثل: مركز الصديق لتحفيظ القرآن" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="centerCity" class="form-label">المدينة *</label>
                        <select id="centerCity" class="form-select" required>
                            <option value="">اختر مدينة...</option>
                            <option value="اربد">اربد</option>
                            <option value="البلقاء">البلقاء</option>
                            <option value="عمان">عمان</option>
                            <option value="الزرقاء">الزرقاء</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="centerAddress" class="form-label">العنوان التفصيلي *</label>
                        <input type="text" id="centerAddress" class="form-input" placeholder="مثال: شارع الجامعة، بجانب المسجد الكبير" required>
                    </div>

                    <div class="form-group">
                        <label for="centerPhone" class="form-label">رقم الهاتف *</label>
                        <input type="tel" id="centerPhone" class="form-input" placeholder="+9627xxxxxxxx" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="centerImage" class="form-label">شعار/صورة المركز</label>
                        <input type="file" id="centerImage" class="form-input-file" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label for="centerEstablished" class="form-label">سنة التأسيس</label>
                        <input type="number" id="centerEstablished" class="form-input" placeholder="مثال: 1999" min="1900" max="2025">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block" id="centerModalSubmitBtn">إرسال للموافقة</button>
                    <button type="button" class="btn btn-secondary btn-block" onclick="closeAddCenterModal()">إلغاء</button>
                    
                </form>
            </div>
        </div>
    </div>


<script>
    // 1. الدالة لجلب البيانات من LocalStorage أو استخدام البيانات التجريبية
    function getCentersData() {
        const storedData = localStorage.getItem('mockCenters');
        if (storedData) {
            return JSON.parse(storedData);
        } else {
            // البيانات التجريبية الأولية
            return [
                { id: '1', name: 'مركز الصديق', city: 'اربد', address: 'المغير', phone: '+96279xxxxxx', established: 1999, status: 'approved' },
                { id: '2', name: 'مركز ابن تيمية', city: 'البلقاء', address: 'الشمالي', phone: '+96279yyyyyy', established: 1997, status: 'approved' },
                { id: '3', name: 'مركز النور الجديد', city: 'عمان', address: 'الجبيهة', phone: '+96278zzzzzz', established: 2024, status: 'pending' },
                { id: '4', name: 'مركز الأنصار', city: 'الزرقاء', address: 'الرصيفة', phone: '+96277wwwwww', established: 2023, status: 'approved' }
            ];
        }
    }

    // 2. الدالة لحفظ البيانات في LocalStorage
    function saveCentersData(centersArray) {
        localStorage.setItem('mockCenters', JSON.stringify(centersArray));
    }

    let mockCenters = getCentersData(); 
    let isPendingFilterActive = false;
    
    // ******************************************************
    // الدوال الأساسية للتحكم بالجدول (CRUD Operations)
    // ******************************************************

    function renderCenters() {
        mockCenters = getCentersData(); 
        
        const tableBody = document.getElementById('centersTableBody');
        tableBody.innerHTML = ''; 

        let centersToDisplay = mockCenters;

        if (isPendingFilterActive) {
            centersToDisplay = mockCenters.filter(center => center.status === 'pending');
        }

        if (centersToDisplay.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="6" style="text-align:center; color: #888; padding: 2rem;">لا توجد مراكز مطابقة للمعايير المحددة حالياً.</td></tr>';
            return;
        }

        centersToDisplay.forEach((center, index) => {
            let statusBadge;
            let actionButtons = `
                <button class="btn btn-sm btn-outline action-btn" onclick="openEditCenterModal('${center.id}')">تعديل</button>
                <button class="btn btn-sm btn-danger action-btn" onclick="deleteCenter('${center.id}')">حذف</button>
            `;

            if (center.status === 'approved') {
                statusBadge = '<span class="badge badge-success">منشور</span>';
            } else if (center.status === 'pending') {
                statusBadge = '<span class="badge badge-warning">معلق للموافقة</span>';
                actionButtons = `
                    <button class="btn btn-sm btn-primary action-btn" onclick="approveCenter('${center.id}')">موافقة</button>
                    ${actionButtons}
                `;
            } else {
                statusBadge = '<span class="badge badge-secondary">غير نشط</span>';
            }
            
            const row = tableBody.insertRow();
            row.innerHTML = `
                <td>${center.id}</td>
                <td>${center.name}</td>
                <td>${center.city}</td>
                <td>${statusBadge}</td>
                <td>${center.established || 'غير محدد'}</td>
                <td>${actionButtons}</td>
            `;
        });
    }

    function approveCenter(centerId) {
        if (confirm(`هل أنت متأكد من الموافقة على المركز ذو المعرف ${centerId} ونشره؟`)) {
            const centerIndex = mockCenters.findIndex(c => c.id === centerId);
            if (centerIndex !== -1) {
                mockCenters[centerIndex].status = 'approved';
                saveCentersData(mockCenters); 
                renderCenters(); 
                alert(`تمت الموافقة على المركز ID: ${centerId} بنجاح.`);
            }
        }
    }

    function deleteCenter(centerId) {
        if (confirm(`هل أنت متأكد من حذف المركز ذو المعرف ${centerId} بشكل دائم؟`)) {
            mockCenters = mockCenters.filter(c => c.id !== centerId);
            saveCentersData(mockCenters); 
            renderCenters(); 
            alert(`تم حذف المركز ID: ${centerId} بنجاح.`);
        }
    }

    function filterCenters() {
        const pendingButton = document.querySelector('.admin-controls button[onclick*="filterCenters"]');
        
        isPendingFilterActive = !isPendingFilterActive;

        if (isPendingFilterActive) {
            pendingButton.classList.add('active-filter');
            pendingButton.textContent = 'إلغاء تصفية المراكز';
        } else {
            pendingButton.classList.remove('active-filter');
            pendingButton.textContent = 'عرض المراكز المعلقة';
        }
        
        renderCenters();
    }

    // ******************************************************
    // الدوال الخاصة بالنموذج المنبثق (Modal Functions)
    // ******************************************************

    function openAddCenterModal() {
        document.getElementById('centerModalTitle').textContent = 'إضافة مركز قرآني جديد';
        document.getElementById('centerModalSubmitBtn').textContent = 'إرسال للموافقة';
        document.getElementById('centerId').value = ''; 
        document.getElementById('addCenterForm').reset();
        document.getElementById('addCenterModal').classList.remove('hidden');
    }

    function openEditCenterModal(centerId) {
        const center = mockCenters.find(c => c.id === centerId);

        if (!center) {
            alert('لم يتم العثور على بيانات المركز!');
            return;
        }

        document.getElementById('centerModalTitle').textContent = `تعديل بيانات: ${center.name}`;
        document.getElementById('centerModalSubmitBtn').textContent = 'حفظ التعديلات';
        document.getElementById('centerId').value = centerId; 

        document.getElementById('centerName').value = center.name;
        document.getElementById('centerCity').value = center.city;
        document.getElementById('centerAddress').value = center.address;
        document.getElementById('centerPhone').value = center.phone;
        document.getElementById('centerEstablished').value = center.established;

        document.getElementById('addCenterModal').classList.remove('hidden');
    }

    function closeAddCenterModal() {
        document.getElementById('addCenterModal').classList.add('hidden');
        document.getElementById('addCenterForm').reset();
    }

    document.getElementById('addCenterForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const centerId = document.getElementById('centerId').value;
        const centerName = document.getElementById('centerName').value;
        
        const formData = {
            name: document.getElementById('centerName').value,
            city: document.getElementById('centerCity').value,
            address: document.getElementById('centerAddress').value,
            phone: document.getElementById('centerPhone').value,
            established: document.getElementById('centerEstablished').value,
        };

        if (centerId) {
            const centerIndex = mockCenters.findIndex(c => c.id === centerId);
            if (centerIndex !== -1) {
                mockCenters[centerIndex] = { ...mockCenters[centerIndex], ...formData };
            }
            alert(`تم حفظ تعديلات المركز: ${centerName}.`);
        } else {
            const newId = (mockCenters.length > 0 ? Math.max(...mockCenters.map(c => parseInt(c.id))) + 1 : 1).toString();
            const newCenter = {
                id: newId, 
                ...formData,
                status: 'pending' 
            };
            mockCenters.push(newCenter);
            alert(`تم إرسال بيانات المركز الجديد: ${centerName} للموافقة.`);
        }
        
        saveCentersData(mockCenters); 
        closeAddCenterModal();
        renderCenters(); 
    });
    
    document.getElementById('addCenterModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeAddCenterModal();
        }
    });

    document.addEventListener('DOMContentLoaded', renderCenters);
</script>
</body>
</html>